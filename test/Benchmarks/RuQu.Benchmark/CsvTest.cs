using BenchmarkDotNet.Attributes;
using System.Globalization;

namespace RuQu.Benchmark
{
    [MemoryDiagnoser]
    public class CsvTest
    {
        private const string testdata = """
                a,b
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                1,2
                3sss,3333
                """;

        [Benchmark]
        public void CsvHelper_Read()
        {
            using var sr = new StringReader(testdata);
            using var csv = new CsvHelper.CsvReader(sr, CultureInfo.InvariantCulture);
            var records = new List<string[]>();
            csv.Read();
            csv.ReadHeader();
            while (csv.Read())
            {
                var record = new string[csv.ColumnCount];
                for (var i = 0; i < record.Length; i++)
                {
                    record[i] = csv.GetField(i);
                }
                records.Add(record);
            }
            var d = records.ToArray();
        }

        [Benchmark]
        public void RuQu_Read_Csv()
        {
            using var reader = new RuQu.Csv.CsvReader(testdata, fristIsHeader: true);
            var d = reader.ToArray();
        }
    }
}